> **※本ページの内容はテキストの第２章に相当します**

# 環境構築
　本資料では[2023年度データ分析勉強会](https://sites.google.com/view/kanto-metrics/2023%E5%B9%B4%E5%BA%A6)の図書である[『統計ソフト「R」超入門』逸見功著](https://bluebacks.kodansha.co.jp/books/9784065020494/appendix/)（以降、テキスト）で利用するR/R Commander環境を構築する方法を紹介しています。Windows環境のみが対象です。他のOSを利用したい場合は[CRAN](https://cran.r-project.org/index.html)にてインストール方法を確認してください。なお、本資料はR/R Commanderが動作することを保証するものではありません。


　環境構築前に下記の条件を満たしていることを確認してください。

* [**勉強会のセキュリティ・ポリシー**](https://sites.google.com/view/kanto-metrics/home#h.n86cgepzr6c)を満たしているWindows PC
* Windowsは**64bit環境**[^1]（Windows10 or Windows11）
* Windowsのユーザアカウント名に日本語や空白・記号が含まれてない[^2]
* プロキシサーバーを介さずにインターネットと通信ができる

[^1]: Rでの32bit環境のサポートは終了しています
[^2]: **日本語および空白・記号を含まず数字から始まらない**アカウントを使用してください

　環境構築の手順は下記の通りです。

1. Rのインストール
    1. ダウンロード
    1. インストール
    1. 起動確認
    1. リカバリー（必要な場合のみ）
1. R Commanderのインストール
    1. インストール
    2. 起動確認
1. 動作確認

## Rのインストール
　テキストのP24から図解されていますので、図解が必要な場合はテキストを参照してください。

### ダウンロード
　Rのインストーラーをダウンロードします。

1. [CRAN](https://cran.r-project.org/bin/windows/base/)からRの最新版インストーラをダウンロードします
1. ダウンロードしたファイルのウィルスチェックをします

:::{.callout-tip}
## Tips: Version
どうしうても書籍と同じバージョンを利用したい場合には[こちら](https://cran.r-project.org/bin/windows/base/old/4.2.2/)からR4.2.2をダウンロードしてください。
:::

### インストール
　Rのインストールではダイアログでの問い合わせに対して基本的にデフォルトを選択します。ただし、R Commnderを使いやすくするために起動時オプションの選択だけはデフォルトから変更します。


1. ダウンロードしたファイル（インストーラ）を実行
    * 以降、ウィザード形式の指示に従う
1. インストール言語を選択
1. ライセンスを確認
1. インストール先を指定
1. コンポーネントを選択
1. 起動時オプションを選択
    * 「**はい(カスタマイズする)**」を選択  
    1. 表示モード
        * 「**SDI(複数のウィンドウを使用して表示)**」[^3]を選択  
    1. ヘルプの表示方法
        * 「**HTMLヘルプ**」[^4]を選択  
1. スタートメニューフォルダーの指定
1. 追加タスクの選択
    * 「アイコンの追加」はお好みで選択
1. インストール状況（プログレス表示）
1. 完了  

[^3]: カスタマイズせずにデフォルトインストールした場合は下記のリカバリーを参考にSDIモードに変更してください
[^4]: ヘルプの表示方法は好みで構いませんがHTML形式の方が関連項目のリンクが使えるので便利です


:::{.callout-tip}
## Tips: MDI or SDI
R Commanderを利用する場合は、操作ウィンドウやグラフ表示に個々のウィンドウを割り当てるSDIモードが便利です。インストール時にMDIを選択してた場合でもR起動後にオプションで変更できます。
:::

### 起動確認
　スタートメニューから［R］-［R 4.x.x］を実行し下図[^5]のようなウィンドウが表示されることを確認します。  

![R Console](./fig/00-11.R.png)

[^5]: 図はR4.3.0でバージョンにより表記が変わります。


　RのウィンドウはそのままでR Commanderのインストールに進みます。

### リカバリー（SDIモードへの変更）
　MDIモードでインストールした場合は下記の手順でSDIモードに変更してください。

1. Rのメニューから［編集］-［GUIプリファレンス...］を実行して設定エディタダイアログを開く  
  ![GUI Preference](./fig/00-51.GuiPreference.png)  
1. 最上段にある［Sigle or multiple］で「SDI」にチェックを入れ［OK］ボタンをクリックする  
  ![Rgui設定エディター](./fig/00-52.GuiPreferenceSDI.png)
1. Rを再起動する

　  

## R Commanderのインストール
　テキストのP28から図解されていますので、図解が必要な場合はテキストを参照してください。  

### インストール
　R Commanderは単独のプログラムではなくRのパッケージ（ライブラリ）として動く機能拡張プログラムですので、インストールはRから行います。

1. Rのメニューから［パッケージ］-［パッケージのインストール...］を実行
1. パッケージをダウンロードするミラーサイトを選択して［OK］をクリック
    * デフォルトの「**0-Cloud[https]**」を選択
1. パッケージ一覧から「**Rcmdr**」を選択して［OK］をクリック
1. パーソナルライブラリの利用確認
    * 初回のみで［はい(Y)］をクリック
1. インストール先の確認
    * 初回のみで［はい(Y)］をクリック
1. パッケージダウンロードのプログレスが複数表示
    * なにもしない
1. R Commanderインストール完了  

![R Console](./fig/00-26.RcmdrInstalled.png)

### 起動確認
　R Commanderが起動することを確認します。

1. Rのメニューから［パッケージ］-［パッケージの読み込み...］を実行
1. 「Rcmdr」を選択
1. 不足パッケージのインストール
    * 初回のみ
1. ダウンロード先の選択
    * デフォルトの「CRAN」を選択
1. R Commander起動  

![R Commander](./fig/00-35.LoadedRcmdr.png)

:::{.callout-tip}
## Tips: How to load
メニューを経由せずにR Commanderを起動するにはRのプロンプト（`>`）に`library(Rcmdr)`と入力してEnterキーを押下します。
:::


## 動作確認
　以下はR Commanderウィンドウでの操作になります。

1. メニューバーの下にある［データセット:］の部分が「<アクティブデータセットなし>」になっていることを確認
1. メニューから［データ］-［パッケージ内のデータ］-［アタッチされたパッケージからデータセットを読み込む...］を実行
1. ［データセット名を入力:］欄に「iris」と入力し［OK］をクリック
1. メニューバーの下にある［データセット:］の部分が「iris」になっていることを確認
1. メニューから［グラフ］-［箱ひげ図...］を実行
1. ［変数］の「Petal.Length」をクリックし［OK］をクリック
1. 別ウィンドウで箱ひげ図が描かれることを確認  

![R Commander](./fig/00-46.BoxplotWindow.png)


## 留意事項
　Rを起動すると下記のメッセージが表示されるように利用やその結果に対しては誰も何も保証することはありません。

> R は、自由なソフトウェアであり、「完全に無保証」です。 

　したがって、利用に際しては結果などに疑問を感じた場合に自ら検証できる基本的な知識は必要です。
　  

---

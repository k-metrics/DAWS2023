```{r setup, echo=FALSE, include=FALSE}
source("./R/setup.R")
```

# データセット

## データセットとは
Rにおけるデータセットとは分析対象となるデータの集まりを意味します。例えば、下表のような車の諸元をまとめたものはデータセットです。
```{r, echo=FALSE}
datasets::mtcars %>% 
  df_print()
```

　  

Rではこのようなデータセットを`data.frame`型という変数型を用いて一つの変数として扱うことができます。なお、`data.frame`型変数はTidy data（整然データ）である必要があります。

　  

:::{.callout-tip}
## Tip: Tidy data（整然データ）
以下の条件を満たす表型のデータをTidy dataといい、構造と意味が合致しているのが特徴です。  
　1. 個々の変数が一つの列をなす  
　2. 個々の観測が一つの行をなす  
　3. 個々の値が一つのセルをなす  
　4. 個々の観測の構成単位の累計が一つの表をなす  

なので、神ExcelはTidy dataにはなり得ません。
:::

　  

`data.frame`型変数は以下のような構造を取る変数型です。このデータセットでは11個の実数型変数（`num`）からなる32組の観測（車種）があることがわかります。
```{r, echo=FALSE}
str(mtcars)
```

　  

## 組み込みデータセット
Rには様々なデータセットがあらかじめ組み込まれています。テキストP36のパッケージ付属データと同義です。特に標準で用意されている`datasets`パッケージには様々なデータセットが組み込まれていますので、代表的なデータセットを簡単に紹介しておきます。

　  

### Iris flower data set
統計学の世界で最も有名な「フィッシャーのアヤメ」のデータセットです。
```{r, eval=FALSE}
datasets::iris
```
```{r, echo=FALSE}
iris %>% 
  df_print()
```
三種類のアヤメの萼片と花弁の計測値が計150組格納されていることがわかります。品種（`Species`）は因子型と呼ばれる変数型になっています。因子型変数は層別処理を行う場合に有用な変数型です。
```{r, echo=FALSE}
str(iris)
```

　  

### New York Air Quarity Measurements
1973年5月から9月にかけてニューヨークで観測された大気データのデータセットで欠損値（欠測値）が含まれています。
```{r, eval=FALSE}
datasets::airquality
```
```{r, echo=FALSE}
airquality %>% 
  df_print()
```
オゾン濃度、日射量、風速、気温などの測定値153日分のデータが格納されて、6変数のすべてが数値データですが、整数型（`int`）と実数型（`num`）が混在しています。欠損値（欠測値）は`NA`と表示されます。
```{r, echo=FALSE}
str(airquality)
```

　  

## データセットを作成する
R Commanderにはデータセットを作成するための機能が組み込まれていますが、Excelのような表計算ソフトを使ってデータファイルをを作成した方が早くて便利ですし融通が利きます。R Commanderが対応している代表的なファイル形式はxls形式、xlsx形式、CSV形式です。

変数名などに日本語が含まれるデータをCSV形式でファイルに保存する場合は必ずUTF-8エンコーディングを指定してください。日本語版ExcelはデフォルトでシフトJISエンコーディングのCSVファイルを作成します。R Commanderの読み込み処理ではエンコーディングが指定されないためにエンコーディングエラーを起こしてファイルを読み込むことができません。このエラーはR 4.2.xからデフォルトエンコーディングがUTF-8に変更されたことに起因しています。

　  

### R Commanderのためのデータセット
R CommanderではGUI操作の弊害で様々なオプションの指定ができないため以下の規則に則ってファイルを作成することで読み込み時のエラーを回避することができます。

1. Tidy data形式を守る
    * 神Excelにしない
2. 一行目には必ず変数名を記載する
    * 変数名に（`_`,`-`を除く）記号・空白を使わない
    * 変数名の最初の文字を数字・記号（`_`,`-`）にしない
        * これらはRの変数名に対する制限です
3. 各列の行数を合わせる
    * 行数が合わないと自動的に先頭からのデータを用いて行数が一致するように埋めてしまう場合があります
        * 正しくないデータセットができてしまう
    * 欠損値（欠測値）の扱いに関しては、明示的に`NA`と文字を入力するか空白（何も入力しない）にするかをあらかじめ決めておく
        * `NA`を使うと表計算ソフトで処理できなくなる可能性あり

　  

## データセットを読み込む
R Commanderでデータセットのファイルを読み込むには［データ］メニューを使います。

　  

### CSV(UTF-8)形式の場合
［データ］-［データのインポート］-［テキストファイルまたはクリップボード,URL から...］を実行すると下図のようなダイアログが開きます。  

![条件設定ダイアログ](./fig/01-01.ReadCSV.png)

各設定項目の意味は

設定項目               | 設定内容
-----------------------|-------------------------------------------------------
データセット名を入力   | データセットの変数名
ファイル内に変数名あり | 一行目を変数名にする場合はチェック
文字変数を因子に変換   | 最初の頃はそのままで
欠測値の記号           | 「NA」のままで（空白でも欠損値扱いになる）
データファイルの場所   | 
フィールドの区切り記号 | CSVの場合は「カンマ」、TSVの場合は「タブ」
小数点の記号           | 通常は「カンマ」

データファイルの場所をローカルファイルシステムまたはインターネットのURLにして
［OK］ボタンをクリックすると入力ダイアログが開きますので、読み込みたいファイルを選択するかURLを入力してください。

　  

### xls形式／xlsx形式の場合
［データ］-［データのインポート］-［エクセルファイルから...］


![条件設定ダイアログ](./fig/01-02.ReadExcel.png)

各設定項目の意味は

設定項目                        | 設定内容
--------------------------------|----------------------------------------------
データセット名を入力            | データセットの変数名
スプレッドシートの1行目の変数名 | 一行目が変数名な場合はチェック
スプレッドシートの1列目の行名   | 最初の頃はそのままで（行名は使わない）
文字列を因子に変換              | 最初の頃はそのままで
欠測値の記号                    | 基本的にはそのままで

　  

### .RData形式の場合
［データ］-［データセットのロード...］を実行するとOSのファイル選択ダイアログが開きますので読み込みたい`.RData`形式のファイルを指定します。

　  

## アクティブデータセット
R Commanderにはアクティブデータセットという概念があります。アクティブデータセットとは計算対象となるデータセットのことで、指定されていないと統計用の算出やグラフによる可視化ができません。

　  

---
